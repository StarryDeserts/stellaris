# stellaris

Stellaris 是一个部署在 Aptos 区块链上的去中心化利率协议。它为用户提供了一套强大的工具，用于将生息资产的未来收益进行代币化、交易和管理，从而在去中心化的世界中创造一个高效的固定利率市场。

## 核心理念

在传统的 DeFi 领域，浮动利率是常态，这为寻求稳定、可预测回报的用户带来了不确定性。Stellaris 通过引入一种新颖的机制——**收益剥离（Yield Stripping）**——来解决这个问题。

其核心思想是将一个生息资产（例如，通过质押获得的 stAPT）分解为其两个基本组成部分：

1. **本金代币 (Principal Token - PT)**：代表了基础生息资产的本金部分。在预设的到期日，一个 PT 可以 1:1 兑换回一个单位的基础资产。由于时间价值，PT 在到期前通常会以折价的方式进行交易，这个折价率就隐含了市场对这段时间内固定利率的定价。
2. **收益代币 (Yield Token - YT)**：代表了在到期日之前，基础生息资产所能产生的所有未来收益。YT 的持有者有权获得这段时间内的全部利息。

通过交易 PT 和 YT，Stellaris 为用户提供了前所未有的灵活性：

- **锁定固定利率**：通过在市场上购买折价的 PT，用户可以锁定一个固定的到期收益率，无需担心底层资产收益率的波动。
- **收益投机**：交易者可以根据对未来利率走势的判断来买卖 YT。如果你认为未来实际收益会高于当前市场预期，你可以购买 YT 来放大你的收益敞口。
- **提高流动性**：用户可以为 PT/SY 交易对提供流动性，从而赚取交易手续费，进一步提高资本效率。

## 协议架构

Stellaris 协议由一系列高度模块化的 Move 合约构成，它们协同工作，共同实现协议的核心功能。

### 主要模块解析

- **`sy` (Standardized Yield - 标准化收益代币)**
  - **功能**: 作为协议的入口，负责将各种不同的生息资产（如 stAPT, stSOL 等）封装成一种标准化的、可互换的 SY 代币。
  - **核心逻辑**: 管理着底层资产的存入和赎回，并精确追踪资产的汇率。
- **`py` (Principal & Yield - 本金与收益代币)**
  - **功能**: 这是协议的核心创新模块。它接收 SY 代币，并根据用户选择的到期日，将其 1:1 分割成 PT 和 YT。
  - **核心逻辑**: 管理 PT 和 YT 的铸造与销毁，并维护每个用户在不同到期日的仓位 (`PyPosition`)。
- **`yield_factory` (收益工厂)**
  - **功能**: 这是一个工厂合约，用于为每一个新的到期日创建对应的 `PyState` 池。每个 `PyState` 池都管理着特定到期日的所有 PT 和 YT 的供应量及相关状态。
- **`market` (自动做市商 - AMM)**
  - **功能**: 实现了为 PT 和 SY 代币设计的自动做市商。用户可以在这里进行两种代币的兑换。
  - **核心逻辑**: 采用了一种专门为利率市场设计的、考虑了时间衰减的定价模型，确保 PT 的价格随着时间的推移会逐渐趋近于其面值（即一个单位的 SY）。
- **`market_factory` (市场工厂)**
  - **功能**: 用于创建新的 `market` 交易池。
- **`oracle` (预言机)**
  - **功能**: 集成了 **Chainlink** 数据源，为协议提供可靠的、实时的外部资产价格。这对于精确计算资产价值、汇率和交易滑点至关重要。
- **`router` (路由器)**
  - **功能**: 作为用户交互的主要入口点，简化了用户的操作流程。用户可以通过路由器合约执行诸如兑换、添加/移除流动性等复杂的多步操作。
- **`math` (数学库)**
  - **功能**: 包含一系列高精度的定点数算术库 (`fixed_point64`, `fixed_point64_with_sign`, `log_exp_math`)。这是在链上执行复杂金融计算、避免浮点数误差、确保协议安全和精确的关键基础。

## 如何使用 (用户流程示例)

1. **存入资产，获得 SY**: 用户将持有的生息资产（如 stAPT）存入 `sy` 模块，获得等值的 SY-stAPT 代币。
2. **铸造 PT 和 YT**: 用户将 SY-stAPT 和一个期望的到期日（如 2024年12月31日）提供给 `yield_factory`，铸造出等量的 PT-stAPT-20241231 和 YT-stAPT-20241231。
3. **交易与投资**:
   - **固定收益**: 用户可以在 `market` 中直接卖掉 YT，保留 PT。这相当于立即将未来的浮动收益变现，从而锁定了一个固定的到期回报率。
   - **购买折价资产**: 用户也可以在市场上直接购买他人卖出的 PT，以低于面值的价格获得未来确定性的本金。
   - **提供流动性**: 用户可以将 PT 和 SY 按一定比例存入 `market` 的流动性池中，成为流动性提供者，赚取交易手续费。
4. **到期赎回**: 在 2024年12月31日之后，用户可以将其持有的 PT-stAPT-20241231 赎回为等量的 SY-stAPT，并最终换回基础资产 stAPT。

## 开发与测试

本项目使用 [Aptos Move](https://aptos.dev/move/book/introduction) 进行开发。

### 环境要求

- [Aptos CLI](https://www.google.com/search?q=https://aptos.dev/cli-tools/aptos-cli/install-aptos-cli)

### 编译

```
aptos move compile --named-addresses stellaris=<YOUR_ADDRESS>
```

### 运行测试

```
aptos move test --named-addresses stellaris=<YOUR_ADDRESS>
```

## 免责声明

Stellaris 是一个实验性的 DeFi 协议。尽管我们尽最大努力确保代码的安全，但在与智能合约交互时，始终存在无法预见的风险。请您在使用前务必进行自己的研究（DYOR），并只投入您愿意承担损失的资金。
